name: Notify CI Failure

on:
  workflow_run:
    workflows: [CI]
    types:
      - completed

jobs:
  notify:
    if: github.event.workflow_run.conclusion == 'failure'
    runs-on: ubuntu-latest
    permissions:
      issues: write
    
    steps:
      - name: Create GitHub issue about CI failure
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const run = context.payload.workflow_run;
            const title = `CI failure: ${run.name} (${run.head_branch})`;
            const body = `Workflow **${run.name}** failed\n\n**Branch:** ${run.head_branch}\n**Commit:** ${run.head_commit}\n\n[View workflow details →](${run.html_url})`;
            
            try {
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title,
                body,
                labels: ['bug', 'ci']
              });
              console.log('✓ Issue created for CI failure');
            } catch (error) {
              console.log('Issue creation skipped:', error.message);
            }
      


